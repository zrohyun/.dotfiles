/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Je=Object.create;var L=Object.defineProperty;var Ye=Object.getOwnPropertyDescriptor;var Ze=Object.getOwnPropertyNames;var Ke=Object.getPrototypeOf,et=Object.prototype.hasOwnProperty;var f=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),tt=(e,r)=>{for(var t in r)L(e,t,{get:r[t],enumerable:!0})},N=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Ze(r))!et.call(e,i)&&i!==t&&L(e,i,{get:()=>r[i],enumerable:!(n=Ye(r,i))||n.enumerable});return e};var rt=(e,r,t)=>(t=e!=null?Je(Ke(e)):{},N(r||!e||!e.__esModule?L(t,"default",{value:e,enumerable:!0}):t,e)),nt=e=>N(L({},"__esModule",{value:!0}),e);var R=f((Tr,V)=>{function it(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}V.exports=it});var $=f((Sr,G)=>{var ot=typeof global=="object"&&global&&global.Object===Object&&global;G.exports=ot});var D=f((wr,U)=>{var st=$(),at=typeof self=="object"&&self&&self.Object===Object&&self,ct=st||at||Function("return this")();U.exports=ct});var Q=f((Lr,X)=>{var lt=D(),pt=function(){return lt.Date.now()};X.exports=pt});var Y=f((kr,J)=>{var dt=/\s/;function ft(e){for(var r=e.length;r--&&dt.test(e.charAt(r)););return r}J.exports=ft});var K=f((Er,Z)=>{var ut=Y(),mt=/^\s+/;function gt(e){return e&&e.slice(0,ut(e)+1).replace(mt,"")}Z.exports=gt});var F=f((Or,ee)=>{var ht=D(),vt=ht.Symbol;ee.exports=vt});var ie=f((jr,ne)=>{var te=F(),re=Object.prototype,yt=re.hasOwnProperty,xt=re.toString,T=te?te.toStringTag:void 0;function bt(e){var r=yt.call(e,T),t=e[T];try{e[T]=void 0;var n=!0}catch(o){}var i=xt.call(e);return n&&(r?e[T]=t:delete e[T]),i}ne.exports=bt});var se=f((Rr,oe)=>{var Tt=Object.prototype,St=Tt.toString;function wt(e){return St.call(e)}oe.exports=wt});var pe=f((Dr,le)=>{var ae=F(),Lt=ie(),kt=se(),Et="[object Null]",Ot="[object Undefined]",ce=ae?ae.toStringTag:void 0;function jt(e){return e==null?e===void 0?Ot:Et:ce&&ce in Object(e)?Lt(e):kt(e)}le.exports=jt});var fe=f((Fr,de)=>{function Rt(e){return e!=null&&typeof e=="object"}de.exports=Rt});var me=f((Ir,ue)=>{var Dt=pe(),Ft=fe(),It="[object Symbol]";function Mt(e){return typeof e=="symbol"||Ft(e)&&Dt(e)==It}ue.exports=Mt});var ye=f((Mr,ve)=>{var Pt=K(),ge=R(),At=me(),he=NaN,Ct=/^[-+]0x[0-9a-f]+$/i,Ht=/^0b[01]+$/i,qt=/^0o[0-7]+$/i,Wt=parseInt;function _t(e){if(typeof e=="number")return e;if(At(e))return he;if(ge(e)){var r=typeof e.valueOf=="function"?e.valueOf():e;e=ge(r)?r+"":r}if(typeof e!="string")return e===0?e:+e;e=Pt(e);var t=Ht.test(e);return t||qt.test(e)?Wt(e.slice(2),t?2:8):Ct.test(e)?he:+e}ve.exports=_t});var Te=f((Pr,be)=>{var zt=R(),I=Q(),xe=ye(),Bt="Expected a function",Nt=Math.max,Vt=Math.min;function Gt(e,r,t){var n,i,o,a,s,c,p=0,h=!1,m=!1,d=!0;if(typeof e!="function")throw new TypeError(Bt);r=xe(r)||0,zt(t)&&(h=!!t.leading,m="maxWait"in t,o=m?Nt(xe(t.maxWait)||0,r):o,d="trailing"in t?!!t.trailing:d);function g(l){var y=n,b=i;return n=i=void 0,p=l,a=e.apply(b,y),a}function v(l){return p=l,s=setTimeout(w,r),h?g(l):a}function Ue(l){var y=l-c,b=l-p,B=r-y;return m?Vt(B,o-b):B}function _(l){var y=l-c,b=l-p;return c===void 0||y>=r||y<0||m&&b>=o}function w(){var l=I();if(_(l))return z(l);s=setTimeout(w,Ue(l))}function z(l){return s=void 0,d&&n?g(l):(n=i=void 0,a)}function Xe(){s!==void 0&&clearTimeout(s),p=0,n=c=i=s=void 0}function Qe(){return s===void 0?a:z(I())}function j(){var l=I(),y=_(l);if(n=arguments,i=this,c=l,y){if(s===void 0)return v(c);if(m)return clearTimeout(s),s=setTimeout(w,r),g(c)}return s===void 0&&(s=setTimeout(w,r)),a}return j.cancel=Xe,j.flush=Qe,j}be.exports=Gt});var xr={};tt(xr,{default:()=>yr});module.exports=nt(xr);var $e=rt(Te()),u=require("obsidian");var Se={max:0,mode:"default"};var $t=e=>Object.fromEntries(Object.entries(e).map(([r,t])=>r!=="i"&&t&&t!="0"&&[r,t]).filter(Boolean)),Ut=e=>Object.fromEntries(Object.keys(e).map(r=>{let t=e[r];return[r,Array.isArray(t)?t.map(n=>n==null?void 0:n.trim()):t===!!t?t:t==null?void 0:t.trim()]})),Xt=e=>{let[r="",...t]=e.split("|"),[n="",i]=r.split(":"),[o,a]=n.split("?");return{k:o,i,n:a==="",f:t}},Le=e=>!!(e.o||e.r),Qt=(e,r)=>{let[t,n]=e.split(":");n||(n=t,t=r);let i=n.split("|"),[o,a,s,c,p,h]=i,m=i.filter(d=>d!==void 0).length;return m===1?{k:t,r:o}:m===2?{k:t,o,r:a}:m===3?{k:t,z:o,o:a,r:s}:{k:t,z:o,o:a,t:s,f:c,m:p,r:h}},ke=/^\{.*\}$/,Ee=e=>Object.fromEntries(M(e).split(",").map(r=>r.split(":")).reduce((r,t)=>t.length===2?[...r,t.map(n=>n.trim())]:(r[r.length-1][1]+=","+t[0],r),[])),we=/(\{(?:[^{}]+|\{(?:[^{}]+)*\})*\})/g,M=e=>e.substring(1,e.length-1),Oe=(e,r=!0,t="",n="")=>e.split(we).map(i=>{if(!i.match(we))return i;let o=M(i);if(o.startsWith("{"))return Qt(M(o),n);let a=Xt(o);return n=a.k||n,!t&&(t=n),a}).map(i=>{if(typeof i=="string")return i;i.k||(i.k=t||"0");let o=Ut(i);return r?$t(o):o});var Jt=(e,r,t)=>r.reduce((n,i)=>{var o,a;return(a=i.match(ke)?(s=>{var c;return(c=s[n])!==null&&c!==void 0?c:s["*"]})(Ee(i)):(o=e[i])===null||o===void 0?void 0:o.call(e,n))!==null&&a!==void 0?a:n},t),Yt=(e,{z:r,o:t,t:n,f:i,m:o,r:a},s)=>{switch(r&&s==0?"zero":e.select(s)){case"zero":return r;case"one":return t;case"two":return n;case"few":return i!=null?i:a;case"many":return o!=null?o:a;default:return a}},Zt=/\?\?/g,Kt=(e,r,t,n)=>e.map(i=>{if(typeof i=="string")return i;let{k:o="0",f:a=[]}=i,s=n[o];if(Le(i))return((typeof s=="boolean"?s?i.o:i.r:Yt(r,i,s))||"").replace(Zt,s);let c=a.length?Jt(t,a,s):s;return(""+(c!=null?c:"")).trim()}).join(""),P=(e,r,t,n)=>{let i=n[0],o=i&&typeof i=="object"&&i.constructor===Object,a=n.length===1&&o?i:n;return Kt(e,r,t,a)};var je=(e,r)=>e[r]||(e[r]=Oe(r));var er=(e,r)=>{let t={},n=new Intl.PluralRules(e);return(i,...o)=>P(je(t,i),n,r,o)};function k(e,r,t={}){return De(r,er(e,t))}var Re=(e={},r)=>typeof e=="string"?r.bind(null,e):Object.assign(Object.defineProperty(()=>"","name",{writable:!0}),e),De=(e,r)=>new Proxy(Re(e,r),{get:(t,n)=>n===Symbol.iterator?[][Symbol.iterator].bind(Object.values(t).map(i=>Re(i,r))):De(t[n],r)});var A=(e,r)=>{let t={};return new Proxy({},{get:(n,i)=>t[i]||(t[i]=k(i,e[i],r[i]))})};var rr=(e,r)=>{var n;let t=(n=e==null?void 0:e.split(";").map(i=>i.trim()).find(i=>i.startsWith(r)))==null?void 0:n.split("=")[1];return t?[t]:[]},Fe=(e="lang")=>()=>rr(document==null?void 0:document.cookie,e),nr=Fe();var ir=e=>!!e,Ie=(e="lang")=>()=>{var r;return[(r=window==null?void 0:window.localStorage)==null?void 0:r.getItem(e)].filter(ir)},or=Ie();var Me=(e="lang")=>()=>{var t,n;let r=(n=(t=location==null?void 0:location.search)==null?void 0:t.slice(1).split("&").find(i=>i.startsWith(e)))==null?void 0:n.split("=")[1];return r?[r]:[]},sr=Me();var ar=e=>!!e,Pe=(e="lang")=>()=>{var r;return[(r=window==null?void 0:window.sessionStorage)==null?void 0:r.getItem(e)].filter(ar)},cr=Pe();var pr=Ce;function Ce(){var e=[].slice.call(arguments),r=!1;typeof e[0]=="boolean"&&(r=e.shift());var t=e[0];if(Ae(t))throw new Error("extendee must be an object");for(var n=e.slice(1),i=n.length,o=0;o<i;o++){var a=n[o];for(var s in a)if(Object.prototype.hasOwnProperty.call(a,s)){var c=a[s];if(r&&dr(c)){var p=Array.isArray(c)?[]:{};t[s]=Ce(!0,Object.prototype.hasOwnProperty.call(t,s)&&!Ae(t[s])?t[s]:p,c)}else t[s]=c}}return t}function dr(e){return Array.isArray(e)||{}.toString.call(e)=="[object Object]"}function Ae(e){return!e||typeof e!="object"&&typeof e!="function"}var C=()=>(e,r)=>pr({},e,r),Dn=C();var He=["en","zh"];var E={},H={},An=C();var qe=()=>A(E,H);var We=e=>({});var fr={setting:{mode:{title:"Mode",description:"By default, display the current heading, the parent heading, and the siblings of the parent heading. In concise mode, only display the current heading and the parent heading.",default:"Default",concise:"Concise"},max:{title:"Display quantity limit",description:"Maximum number of headings that can be displayed. 0 indicates no limit."}}},_e=fr;var ur={setting:{mode:{title:"\u6A21\u5F0F",description:"\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u663E\u793A\u5F53\u524D\u6807\u9898\u3001\u7236\u6807\u9898\u548C\u7236\u6807\u9898\u7684\u5144\u5F1F\u6807\u9898\u3002\u7B80\u6D01\u6A21\u5F0F\u4E0B\uFF0C\u4EC5\u663E\u793A\u5F53\u524D\u6807\u9898\u548C\u7236\u6807\u9898\u3002",default:"\u9ED8\u8BA4",concise:"\u7B80\u6D01"},max:{title:"\u663E\u793A\u6570\u91CF\u9650\u5236",description:"\u6700\u5927\u663E\u793A\u6807\u9898\u6570\u91CF\uFF0C0 \u8868\u793A\u4E0D\u9650\u5236\u3002"}}},ze=ur;var mr={en:_e,zh:ze},gr=e=>{E[e]||(E[e]=mr[e],hr(e))},Be=()=>He.forEach(gr),hr=e=>void(H[e]=We(e));Be();var Ne="en";try{Ne=(window.i18next.language||"").startsWith("zh")?"zh":"en"}catch(e){}var vr=qe()[Ne],x=vr;var Ve=require("obsidian");function O(e){return e instanceof Ve.TFile?["md","markdown"].includes(e.extension):!1}function Ge(e,r){var t,n;return(n=(t=r.metadataCache.getFileCache(e))==null?void 0:t.headings)!=null?n:[]}function q(e,r,t){if(!e.length)return r;let n=e.reduce((o,a)=>Math.min(o,a.level),6),i=e.reduce((o,a,s)=>(a.level===n&&o.push(s),o),[]);if(t==="concise")i.length>=1&&r.push(e[i[i.length-1]]);else for(let o of i)r.push(e[o]);q(e.slice(i[i.length-1]+1),r,t)}var S=class extends u.Plugin{constructor(){super(...arguments);this.fileResolveMap={};this.detectPosition=(0,$e.default)(t=>{let n=t.target;if((n==null?void 0:n.classList.contains("cm-scroller"))||(n==null?void 0:n.classList.contains("markdown-preview-view"))){let o=n==null?void 0:n.closest(".view-content");if(o){let a=Object.keys(this.fileResolveMap).filter(s=>this.fileResolveMap[s].container===o);this.updateHeadings(a)}}},20,{leading:!0,trailing:!0})}async onload(){await this.loadSettings(),this.registerEvent(this.app.workspace.on("file-open",t=>{if(t&&O(t)){let n=this.app.workspace.getActiveViewOfType(u.MarkdownView),i=n==null?void 0:n.leaf.id;i&&(i in this.fileResolveMap||(n.onResize=this.makeResize(i)),this.fileResolveMap[i]={resolve:!0,file:t,container:n.contentEl,view:n,lastHeight:0},this.checkFileResolveMap(),this.updateHeadings([i]))}})),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.checkFileResolveMap(),this.updateHeadings(Object.keys(this.fileResolveMap))})),this.registerEvent(this.app.workspace.on("active-leaf-change",t=>{t!=null&&t.id&&t.view instanceof u.MarkdownView&&(this.checkFileResolveMap(),this.updateHeadings([t.id]))})),this.registerEvent(this.app.workspace.on("editor-change",(t,n)=>{let{file:i}=n;i&&O(i)&&Object.values(this.fileResolveMap).forEach(o=>{o.file.path===i.path&&(o.resolve=!1)})})),this.registerEvent(this.app.metadataCache.on("resolve",t=>{if(O(t)){let n=[];Object.keys(this.fileResolveMap).forEach(i=>{let o=this.fileResolveMap[i];o.file.path===t.path&&!o.resolve&&(o.resolve=!0,n.push(i))}),n.length>0&&(this.checkFileResolveMap(),this.updateHeadings(n))}})),this.registerDomEvent(document,"scroll",this.detectPosition,!0),this.addSettingTab(new W(this.app,this))}checkFileResolveMap(){let t=[];this.app.workspace.iterateLeaves(this.app.workspace.getFocusedContainer(),n=>{if(n.id&&(t.push(n.id),!(n.id in this.fileResolveMap)&&n.view instanceof u.MarkdownView)){let i=n.view.getFile();i&&(this.fileResolveMap[n.id]={resolve:!0,file:i,container:n.view.contentEl,view:n.view,lastHeight:0})}}),Object.keys(this.fileResolveMap).forEach(n=>{t.includes(n)||delete this.fileResolveMap[n]})}makeResize(t){return()=>{this.updateHeadings([t])}}updateHeadings(t){t.forEach(n=>{let i=this.fileResolveMap[n];if(i){let{file:o,view:a,container:s}=i,c=Ge(o,this.app),p=a.currentMode.getScroll();this.renderHeadings(c,s,p,a,n)}})}renderHeadings(t=[],n,i,o,a){let s=t.filter(d=>d.position.end.line+1<=i),c=[];s.length&&q(s,c,this.settings.mode);let p=n.querySelector(".sticky-headings-container");if(!p){let d=createDiv({cls:"sticky-headings-root"});p=d.createDiv({cls:"sticky-headings-container"}),n.prepend(d)}p.empty(),this.settings.max&&(c=c.slice(-this.settings.max)),c.forEach(d=>{let g=createDiv({cls:`sticky-headings-item sticky-headings-level-${d.level}`,text:d.heading}),v=createDiv({cls:"sticky-headings-icon"});(0,u.setIcon)(v,`heading-${d.level}`),g.prepend(v),p.append(g),g.addEventListener("click",()=>{o.currentMode.applyScroll(d.position.start.line,{highlight:!0}),setTimeout(()=>{o.currentMode.applyScroll(d.position.start.line,{highlight:!0})},20)})});let h=p.scrollHeight,m=h-this.fileResolveMap[a].lastHeight;m!==0&&(p.parentElement.style.height=h+"px",n.querySelectorAll(".markdown-source-view, .markdown-reading-view").forEach(g=>{let v=g.querySelector(".cm-scroller, .markdown-preview-view");g.style.paddingTop=h+"px",v==null||v.scrollTo({top:v.scrollTop+m,behavior:"instant"})}),this.fileResolveMap[a].lastHeight=h)}onunload(){}async loadSettings(){this.settings={...Se,...await this.loadData()}}async saveSettings(){await this.saveData(this.settings)}},W=class extends u.PluginSettingTab{constructor(r,t){super(r,t),this.plugin=t}update(r){this.plugin.settings=r,this.plugin.saveSettings()}display(){let{containerEl:r}=this;r.empty(),new u.Setting(r).setName(x.setting.mode.title()).setDesc(x.setting.mode.description()).addDropdown(t=>{t.addOption("default",x.setting.mode.default()),t.addOption("concise",x.setting.mode.concise()),t.setValue(this.plugin.settings.mode),t.onChange(n=>{this.update({...this.plugin.settings,mode:n})})}),new u.Setting(r).setName(x.setting.max.title()).setDesc(x.setting.max.description()).addText(t=>{t.setValue(this.plugin.settings.max.toString()),t.onChange(n=>{this.update({...this.plugin.settings,max:parseInt(n,10)||0})})})}};var yr=S;
