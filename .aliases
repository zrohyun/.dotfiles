#!/bin/bash
##############################################################################
########################### zrohyun custom aliases ###########################
##############################################################################

# Unix
alias ln="ln -v"
alias mkdir="mkdir -vp"

# handy short cuts #
alias h='history'
alias j='jobs -l'
alias c='clear'
alias now='date'
alias hg='history|grep'

if [[ $SHELL == *"zsh"* ]]; then
    alias reload="source $HOME/.zshrc"
    # alias reload="omz reload"
elif [[ $SHELL == *"bash"* ]] && [[ -e $HOME/.bashrc ]]; then
    alias reload=". $HOME/.bashrc"
fi


#TODO: export 분리, export, path, etc.. load 순서 결정
if command -v hx &>/dev/null; then
    export EDITOR=hx
    export VISUAL=hx
elif command -v vim &>/dev/null; then
    export EDITOR=vim
    export VISUAL=vim
elif command -v vi &>/dev/null; then
    export EDITOR=vi
    export VISUAL=vi
elif command -v nano &>/dev/null; then
    export EDITOR=nano
    export VISUAL=nano
elif command -v emacs &>/dev/null; then
    export EDITOR=emacs
    export VISUAL=emacs
fi

alias e="$EDITOR"
alias v="$VISUAL"

if [[ $machine == 'Linux' ]]; then
    alias os="uname -a && cat /etc/os-release"
elif [[ $machine == 'Mac' ]]; then
    alias os="uname -a && sw_vers && system_profiler SPSoftwareDataType"
fi

# dotfiles
if [[ -d $HOME/.dotfiles ]]; then
    alias dotfiles="cd $HOME/.dotfiles"
fi

# machine directory alias
if [[ $machine == 'Mac' ]]; then
  if [[ -d $HOME ]]; then
    alias home="cd $HOME"
    alias Home="cd $HOME"
  fi

  if [[ -d $HOME/Desktop ]]; then
    alias desktop="cd $HOME/Desktop"
    alias Desktop="cd $HOME/Desktop"
  fi

  if [[ -d $HOME/Downloads ]]; then
    alias downloads="cd $HOME/Downloads"
    alias Downloads="cd $HOME/Downloads"
  fi

  if [[ -d $HOME/obsidian-zro ]]; then
    alias obsidian="cd $HOME/obsidian-zro"
  fi
fi

# Pretty print the path
alias path='echo $PATH | tr -s ":" "\n"'
alias hey='tmux new -As main'
alias hi=hey

# vim command
if command -v hx &> /dev/null; then
    alias vi=hx
elif command -v vim &> /dev/null; then
    alias vi=vim
# else
#   echo "'hx', 'vim' command is not installed"
fi 

# trash command
if command -v trash &> /dev/null; then
    alias rm='trash -v'
    alias rm-list='trash-list'
# else
#   echo "'trash' command is not installed"
fi 

# trash command
if command -v btop &> /dev/null; then
    alias top='btop'
elif command -v htop &>/dev/null; then
    alias top='htop'
# else
#   echo "'trash' command is not installed"
fi 


# tldr command -> cht
if command -v tldr &> /dev/null; then
    alias man='tldr'
elif command -v cht.sh &>/dev/null; then
    alias man='cht.sh'
elif command -v curl &>/dev/null; then
    function cht() {
        curl cht.sh/$1 # https://github.com/chubin/cheat.sh
    }
    alias man=cht
# else
#     echo "'tldr' command is not installed"
fi

# thefuck command
if command -v thefuck &>/dev/null; then
    eval $(thefuck --alias)
# else
    # echo "'thefuck' command is not installed"
fi

# fd
if command -v fdfind &>/dev/null; then
    alias fd='fdfind -aI'
    alias find=fd
fi

# exa
if command -v exa &>/dev/null; then
    alias ls='exa --icons'
    alias la='ls -lah'
fi

if command -v lsd &>/dev/null; then
    alias ls='lsd'
    alias la='lsd -lah'
    alias ll='lsd -lh'
fi

#TODO: alias 등록하려고 했으나 cd했을 때 $HOME으로 안감.
# 추후 수정하거나 그냥 alias 등록하지 않는 것으로 해야할 듯
# if command -v z &>/dev/null; then
#   alias cd=z
# fi

# NOT MUST HAVE ITEM

# KUBERNETES
if command -v k9s &>/dev/null; then
    alias ks=k9s
fi

# bat
if command -v batcat &>/dev/null; then
    alias bat='batcat'
fi

# duf
if command -v duf &>/dev/null; then
    alias df='duf'
fi

# dust
if command -v dust &>/dev/null; then
    alias du='dust'
fi

# nc, telnet
if command -v naaac &>/dev/null; then
    alias nc='nc -v'
    #?
    # alias conn=nc
    # alias acl=nc
elif command -v teaaalnet &>/dev/null; then
    alias nc=telnet
    conn() {
        # Usage Example
        # $ conn localhost 80
        echo "Connecting with telnet"
        telnet $1 $2
    }
elif command -v $(which bash) &>/dev/null; then
    nc() {
        if [ $# -lt 2 ]; then
            # Usage Example
            # $ nc localhost 80
            echo "Usage: nc [host] [port]"
            return 1
        fi
        $(which bash) -c "echo > /dev/tcp/$1/$2 && [[ $? -eq 0 ]] && echo 'Connection to $1 port $2' succeeded!"
    }
elif command -v curl &>/dev/null; then
    nc() {
        if [ $# -lt 2 ]; then
            # Usage Example
            # $ nc localhost 80
            echo "Usage: nc [host] [port]"
            return 1
        fi
        curl -v telnet://$1:$2
    }
fi

# network
#TODO: print port with title, and pid
if [[ $machine == "Linux" ]]; then
    openports() {
        local sudo_cmd=""
        local arg="${1:-default}"

        if [[ "$arg" == "-h" || "$arg" == "help" ]]; then
            echo "Usage: openports [sudo] [command]"
            echo "Options:"
            echo "  sudo     : Run with elevated privileges (requires sudo)"
            echo "  command  : Specify a specific command (netstat, lsof, nmap, ss)"
            echo "  -p       : [TODO]Show the PID of open ports"
            return 0
        fi

        if [[ "$arg" == "sudo" ]]; then
            if command -v sudo &>/dev/null; then
                if sudo -v &>/dev/null; then
                    sudo_cmd="sudo"
                    arg="${2:-default}"
                    # shift  # Remove "sudo" from the arguments
                else
                    echo "Error: sudo permission is required to run this command."
                    exit 1
                fi
            else
                echo "Error: sudo command not found. Please install sudo."
                exit 1
            fi
        fi

        local commands=("netstat" "lsof" "nmap" "ss")
        for cmd in "${commands[@]}"; do
            if [[ $arg == "default" ]] || [[ $cmd == $arg ]]; then
                if command -v "$cmd" &>/dev/null; then
                    echo "Checking open ports using $cmd..."
                    case "$cmd" in
                        "lsof")
                            echo "$sudo_cmd lsof -i -P -n | grep LISTEN"
                            $sudo_cmd lsof -i -P -n | grep LISTEN
                            ;;
                        "netstat")
                            echo "$sudo_cmd netstat -tuln"
                            $sudo_cmd netstat -tuln
                            ;;
                        "ss")
                            echo "$sudo_cmd ss -tuln"
                            $sudo ss -tuln
                            ;;
                        "nmap")
                            echo "$sudo_cmd nmap -p 1-65535 localhost"
                            $sudo_cmd nmap -p 1-65535 localhost
                            ;;
                    esac
                    return 0
                else
                    echo "$cmd is not installed"
                fi
            # else
            #     echo "$cmd is not your command($arg)"
            fi
        done

        echo "No suitable command found for checking open ports."
        return 1
    }
elif [[ $machine == "Mac" ]]; then
    openports() {
        local sudo_cmd=""
        local arg="${1:-default}"

        if [[ "$arg" == "-h" || "$arg" == "help" ]]; then
            echo "Usage: openports [sudo] [command]"
            echo "Options:"
            echo "  sudo     : Run with elevated privileges (requires sudo)"
            echo "  command  : Specify a specific command (netstat, lsof, nmap, ss)"
            echo "  -p       : [TODO]Show the PID of open ports"
            return 0
        fi

        if [[ "$arg" == "sudo" ]]; then
            if command -v sudo &>/dev/null; then
                if sudo -v &>/dev/null; then
                    sudo_cmd="sudo"
                    arg="${2:-default}"
                else
                    echo "Error: sudo permission is required to run this command."
                    return 1
                fi
            else
                echo "Error: sudo command not found. Please install sudo."
                return 1
            fi
        fi

        # TODO: if commands안에 $cmd가 없다면 
        # TODO: open된 port의 PID 출력(Implement checking for open port PID)
        local commands=("netstat" "lsof" "nmap" "ss")

        for cmd in "${commands[@]}"; do
            if [[ $arg == "default" ]] || [[ $cmd == $arg ]]; then
                if command -v "$cmd" &>/dev/null; then
                    echo "Checking open ports using $cmd..."
                    case "$cmd" in
                        "lsof")
                            echo "$sudo_cmd lsof -i -P -n | grep LISTEN"
                            $sudo_cmd lsof -i -P -n | grep LISTEN
                            ;;
                        "netstat")
                            echo "$sudo_cmd netstat -an | grep LISTEN"
                            $sudo_cmd netstat -an | grep LISTEN
                            ;;
                        "ss")
                            echo "$sudo_cmd ss -tuln | grep LISTEN"
                            $sudo_cmd ss -tuln | grep LISTEN
                            ;;
                        "nmap")
                            echo "$sudo_cmd nmap -p 1-65535 localhost"
                            $sudo_cmd nmap -p 1-65535 localhost
                            ;;
                    esac
                    return 0
                else
                    echo "$cmd is not installed"
                    return 1
                fi
            fi
        done

        echo "No suitable command found for checking open ports."
        return 1
    }
fi

